<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sky.mapper.SetmealMapper">

    <!--错误的SQL语句-->
<!--    <insert id="insert" useGeneratedKeys="true" keyProperty="id">-->
<!--        insert into setmeal(category_id, name, price, description, image, create_time, update_time, create_user, update_user)-->
<!--        values (category_id=#{categoryId}, name=#{name}, price=#{price}, description=#{description}, image=#{image},-->
<!--                create_time=#{createTime}, update_time=#{updateTime}, create_user=#{createUser}, update_user=#{updateUser})-->
<!--    </insert>-->

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into setmeal(category_id, name, price, description, image, create_time, update_time, create_user, update_user)
        values (#{categoryId}, #{name}, #{price}, #{description}, #{image},
                #{createTime}, #{updateTime}, #{createUser}, #{updateUser})
    </insert>

    <update id="update" >
        update setmeal
        <set>
            <if test="categoryId != null">category_id=#{categoryId},</if>
            <if test="name != null">name=#{name},</if>
            <if test="price != null">price=#{price},</if>
            <if test="description != null">description=#{description},</if>
            <if test="image != null">image=#{image},</if>
        </set>
            where id=#{id}
    </update>

    <!--查询setmeal表，同时查询分类表获得分类名称-->
    <select id="pageQuery" resultType="com.sky.vo.SetmealVO">
        select s.*, c.name category_name
        from setmeal s
        left outer join category c
        on s.category_id = c.id
        <where>
            <if test="name != null and name != ''">
                and s.name like concat('%', #{name}, '%')
            </if>
            <if test="categoryId != null">
                and s.category_id=#{categoryId}
            </if>
            <if test="status != null">
                and s.status=#{status}
            </if>
        </where>
    </select>
</mapper>
